# üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã: –ë–∏–ª–µ—Ç—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏

## –î–∞—Ç–∞: 2025-01-27
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 782245481 –∫—É–ø–∏–ª –ø–æ–¥–ø–∏—Å–∫—É, –Ω–æ –Ω–µ –ø–æ–ª—É—á–∏–ª –±–∏–ª–µ—Ç—ã  
**–°—Ç–∞—Ç—É—Å:** üî¥ –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞

---

## üìã –°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:**
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `/api/orders/create`
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –±—ç–∫–µ–Ω–¥ `/v1/orders/create`
   - –ë—ç–∫–µ–Ω–¥ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Telegram Stars:**
   - –ü–ª–∞—Ç–µ–∂ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è Telegram
   - –ë—ç–∫–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–ª–∞—Ç–µ–∂–µ

3. **–ë—ç–∫–µ–Ω–¥ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∑–∞–∫–∞–∑:**
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `activateOrder()` –≤ `orderProcessingService.ts`
   - –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `completed` (–∏–ª–∏ `paid`)

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤:**
   - –ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `awardSelfPurchaseTicket()`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –∫–æ–Ω–∫—É—Ä—Å –∞–∫—Ç–∏–≤–µ–Ω
   - –°–æ–∑–¥–∞—é—Ç—Å—è –±–∏–ª–µ—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `ticket_ledger`

---

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ó–∞–∫–∞–∑ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω (—Å—Ç–∞—Ç—É—Å –Ω–µ `completed` –∏–ª–∏ `paid`)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω, –Ω–æ —Å—Ç–∞—Ç—É—Å –æ—Å—Ç–∞–ª—Å—è `pending`
- –ë–∏–ª–µ—Ç—ã –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã, —Ç–∞–∫ –∫–∞–∫ `activateOrder()` –Ω–µ –≤—ã–∑–≤–∞–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 782245481
# –ù–∞ –±—ç–∫–µ–Ω–¥–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Telegram —É–≤–µ–¥–æ–º–ª—è–µ—Ç –±—ç–∫–µ–Ω–¥ –æ –ø–ª–∞—Ç–µ–∂–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `activateOrder()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

---

### 2. –ö–æ–Ω–∫—É—Ä—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- `getActiveContest()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null`
- –ë–∏–ª–µ—Ç—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–Ω–∫—É—Ä—Å –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `is_active = 1` –≤ —Ç–∞–±–ª–∏—Ü–µ `contests`

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–Ω–∫—É—Ä—Å –∞–∫—Ç–∏–≤–µ–Ω –≤ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ –ø—Ä–æ–ø—É—Å–∫–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

---

### 3. –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –¥–æ –Ω–∞—á–∞–ª–∞ –∏–ª–∏ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–æ–Ω–∫—É—Ä—Å –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ –±–∏–ª–µ—Ç—ã –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã
- –í –ª–æ–≥–∞—Ö: "Order was created before contest start" –∏–ª–∏ "Order was created after contest end"

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞
- –°—Ä–∞–≤–Ω–∏—Ç—å `order.createdAt` —Å `contest.starts_at` –∏ `contest.ends_at`

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å –±–∏–ª–µ—Ç—ã –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –±—ã–ª –≤ –ø–µ—Ä–∏–æ–¥ –∫–æ–Ω–∫—É—Ä—Å–∞

---

### 4. –ë–∏–ª–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–¥—É–±–ª–∏–∫–∞—Ç)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ó–∞–∫–∞–∑ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, –∫–æ–Ω–∫—É—Ä—Å –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ –±–∏–ª–µ—Ç—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã
- –í –ª–æ–≥–∞—Ö: "Self-purchase ticket already exists for order ord_xxx"

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT * FROM ticket_ledger 
WHERE order_id = 'ord_xxx' AND reason = 'SELF_PURCHASE';
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ë–∏–ª–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

---

### 5. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∏–ª–µ—Ç—ã)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë–∏–ª–µ—Ç—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- API `/api/referral/tickets` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏–ª–µ—Ç—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoint `/api/referral/tickets`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –±—ç–∫–µ–Ω–¥–∞
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 782245481
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'completed' –∏–ª–∏ 'paid')
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤
journalctl -u vpn-bot -f | grep -i "awardSelfPurchaseTicket\|SELF_PURCHASE\|782245481"
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `[ContestService] Awarded X self-purchase tickets to user 782245481`
- `[ContestService] Order ord_xxx was created before contest start`
- `[ContestService] Order ord_xxx was created after contest end`
- `[ContestService] Self-purchase ticket already exists for order ord_xxx`

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–ª–µ—Ç—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –±–∏–ª–µ—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 782245481
SELECT 
    tl.id,
    tl.referrer_id,
    tl.order_id,
    tl.delta,
    tl.reason,
    datetime(tl.created_at) as created
FROM ticket_ledger tl
WHERE tl.referrer_id = 782245481
ORDER BY tl.created_at DESC
LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT 
    o.id,
    o.user_id,
    o.plan_id,
    o.status,
    o.payment_status,
    datetime(o.created_at) as created,
    datetime(o.updated_at) as updated
FROM orders o
WHERE o.user_id = 782245481
ORDER BY o.created_at DESC
LIMIT 5;
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–æ–Ω–∫—É—Ä—Å–∞

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã
SELECT 
    id,
    name,
    starts_at,
    ends_at,
    is_active,
    datetime('now') as current_time
FROM contests
WHERE is_active = 1
ORDER BY created_at DESC
LIMIT 1;
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏–ª–µ—Ç—ã
curl -H "Authorization: <telegram_init_data>" \
     https://my.outlivion.space/api/referral/tickets

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π
curl -H "Authorization: <telegram_init_data>" \
     https://my.outlivion.space/api/payments/history
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:

1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞** - –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É, –ø–æ—á–µ–º—É –±–∏–ª–µ—Ç—ã –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã
2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–∫–∞–∑ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—É—Ä—Å** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–Ω–∫—É—Ä—Å –∞–∫—Ç–∏–≤–µ–Ω

### –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, –Ω–æ –±–∏–ª–µ—Ç—ã –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã:

1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–ø—É—Å–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
2. ‚úÖ **–°–æ–∑–¥–∞—Ç—å –±–∏–ª–µ—Ç—ã –≤—Ä—É—á–Ω—É—é** - –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –±—ã–ª –≤ –ø–µ—Ä–∏–æ–¥ –∫–æ–Ω–∫—É—Ä—Å–∞
3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –Ω–∞ –±—ç–∫–µ–Ω–¥–µ** - –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –æ—à–∏–±–∫–∞

### –ï—Å–ª–∏ –±–∏–ª–µ—Ç—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:

1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `/api/referral/tickets` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
2. ‚úÖ **–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –±–∏–ª–µ—Ç—ã

---

## üìù –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤ –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –±–∏–ª–µ—Ç—ã –≤—Ä—É—á–Ω—É—é:

```sql
-- –ü—Ä–∏–º–µ—Ä: –°–æ–∑–¥–∞—Ç—å 1 –±–∏–ª–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 782245481
-- (–∑–∞–º–µ–Ω–∏—Ç—å order_id –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –∑–∞–∫–∞–∑–∞)

INSERT INTO ticket_ledger (
    referrer_id,
    order_id,
    delta,
    reason,
    created_at
) VALUES (
    782245481,
    'ord_xxx',  -- ID –∑–∞–∫–∞–∑–∞
    1,          -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–ª–∞–Ω–∞)
    'SELF_PURCHASE',
    datetime('now')
);
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

**–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –±—ç–∫–µ–Ω–¥–µ, –Ω–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ!**

–§—Ä–æ–Ω—Ç–µ–Ω–¥ (Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ) —Ç–æ–ª—å–∫–æ:
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑—ã —á–µ—Ä–µ–∑ `/api/orders/create`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ `/api/orders/checkPaymentSuccess`
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –±–∏–ª–µ—Ç—ã —á–µ—Ä–µ–∑ `/api/referral/tickets`

**–ë—ç–∫–µ–Ω–¥ (Node.js –±–æ—Ç) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:**
- –ê–∫—Ç–∏–≤–∞—Ü–∏—é –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞
- –ü—Ä–æ–≤–µ—Ä–∫—É —É—Å–ª–æ–≤–∏–π –∫–æ–Ω–∫—É—Ä—Å–∞

---

## üîç –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –±—ç–∫–µ–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 782245481
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –∫–æ–Ω–∫—É—Ä—Å
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–∞—á–∏—Å–ª–µ–Ω—ã –ª–∏ –±–∏–ª–µ—Ç—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±–∏–ª–µ—Ç—ã –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ–º –±–∏–ª–µ—Ç–æ–≤*
