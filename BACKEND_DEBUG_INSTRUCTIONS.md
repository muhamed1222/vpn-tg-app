# üîç –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ—Ç–ª–∞–¥–∫–µ Backend API 401

**–ü—Ä–æ–±–ª–µ–º–∞:** Backend API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 –¥–ª—è `/v1/admin/contest/participants` –¥–∞–∂–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–ª—é—á–æ–º

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Backend API –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–æ—É—Ç–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ `adminApiKey`)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `verifyAdmin` (–ø—Ä–æ–≤–µ—Ä–∫–∞ `request.user`)

---

## üîç –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Backend API

```bash
ssh root@72.56.93.135
cd /opt/outlivion-api
npm run build
systemctl restart outlivion-api
systemctl status outlivion-api
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

```bash
journalctl -u outlivion-api -n 50 | grep -i "admin\|registered"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
[Admin] Admin routes registered { hasAdminApiKey: true, adminApiKeyLength: 9, adminApiKeyPreview: 'A24...' }
```

### 3. –°–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
curl "https://api.outlivion.space/v1/admin/contest/participants?contest_id=550e8400-e29b-41d4-a716-446655440000" \
  -H "x-admin-api-key: A246123b"
```

–ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
journalctl -u outlivion-api -n 20 | grep -i "admin\|verify"
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
- `[Admin] verifyAdmin check` - —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ `request.user`
- `[Admin] Access granted via isAdmin flag` - –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞
- `[Admin] No user in request` - –µ—Å–ª–∏ `request.user` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

---

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: `request.user` –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** `verifyAuth` –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `request.user` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `x-admin-api-key`

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ `verifyAuth` (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: `adminApiKey` –ø—É—Å—Ç–æ–π

**–ü—Ä–∏—á–∏–Ω–∞:** `fastify.adminApiKey` –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ `.env`

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `hasAdminApiKey: true`

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ü—Ä–∏—á–∏–Ω–∞:** Fastify –º–æ–∂–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ `verifyAdmin` - —Ç–∞–º –±—É–¥—É—Ç –≤–∏–¥–Ω–æ –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å `admin` –∏–ª–∏ `x-`

---

## üéØ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö

1. **–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:**
   - `hasAdminApiKey: true`
   - `adminApiKeyLength: 9` (–¥–ª–∏–Ω–∞ `A246123b`)
   - `adminApiKeyPreview: 'A24...'`

2. **–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ:**
   - `hasUser: true/false`
   - `isAdmin: true/false`
   - `tgId: 0` (–¥–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∫–ª—é—á–∞)

---

**–°—Ç–∞—Ç—É—Å:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Backend API
