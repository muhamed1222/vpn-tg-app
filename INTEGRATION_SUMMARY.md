# üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥ API - –°–≤–æ–¥–∫–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
- **–§–∞–π–ª**: `lib/config.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –ë–∞–∑–æ–≤—ã–π URL API –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `https://vpn.outlivion.space`
- **–§–∞–π–ª**: `.env`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: `NEXT_PUBLIC_API_BASE_URL=https://vpn.outlivion.space`

### 2. –û–±–Ω–æ–≤–ª–µ–Ω API –∫–ª–∏–µ–Ω—Ç
- **–§–∞–π–ª**: `lib/api.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` (–≤–º–µ—Å—Ç–æ `X-Telegram-Init-Data`)
  - –ú–µ—Ç–æ–¥ `auth()` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/me` –±—ç–∫–µ–Ω–¥–∞
  - –ú–µ—Ç–æ–¥ `getUserStatus()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/billing` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  - –ú–µ—Ç–æ–¥ `getUserConfig()` –ø–æ–ª—É—á–∞–µ—Ç VPN –∫–ª—é—á –∏–∑ `/api/me`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `getPaymentsHistory()` –∏ `getTariffs()`
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–ø—Ä–æ—Å—ã (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã, —É–±—Ä–∞–Ω—ã —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ API —Ä–æ—É—Ç—ã (–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **–§–∞–π–ª**: `app/api/tg/auth/route.ts`
  - –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `/api/me` –±—ç–∫–µ–Ω–¥–∞
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç Telegram initData –ø–µ—Ä–µ–¥ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

- **–§–∞–π–ª**: `app/api/user/status/route.ts`
  - –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `/api/me` –∏ `/api/billing` –±—ç–∫–µ–Ω–¥–∞
  - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

- **–§–∞–π–ª**: `app/api/user/config/route.ts`
  - –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `/api/me` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è VPN –∫–ª—é—á–∞

## üì° –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ç–∫–µ–Ω–¥ API

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –±—ç–∫–µ–Ω–¥–∞:
- `GET /api/me` - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–¥–ø–∏—Å–∫–∏
- `GET /api/billing` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞
- `GET /api/payments/history` - –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- `GET /api/tariffs` - –°–ø–∏—Å–æ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤
- `POST /api/payment/create` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `POST /api/payment/success` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` —Å Telegram `initData`.

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å**: 
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã –∏–∑ `lib/api.ts`
   - –ó–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ `https://vpn.outlivion.space/api/...`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` —Å Telegram initData

2. **–°–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)**:
   - –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å CORS, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Next.js API —Ä–æ—É—Ç—ã
   - –†–æ—É—Ç—ã –≤ `app/api/` –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –±—ç–∫–µ–Ω–¥
   - –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `config.api.baseUrl` –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **CORS**: –ï—Å–ª–∏ –±—ç–∫–µ–Ω–¥ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –¥–æ–º–µ–Ω–∞ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å CORS. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Next.js API —Ä–æ—É—Ç—ã.

2. **Telegram Bot Token**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `TELEGRAM_BOT_TOKEN` –≤ `.env` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–æ–∫–µ–Ω–æ–º –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

3. **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: –ë—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
   ```typescript
   {
     id: number;
     firstName: string;
     subscription: {
       is_active: boolean;
       expires_at: number | null; // timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
       vless_key?: string;
     };
   }
   ```
   
   –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —ç—Ç–æ –≤ —Ñ–æ—Ä–º–∞—Ç:
   ```typescript
   {
     user: { id, firstName, username? };
     subscription: { status: 'active' | 'expired' | 'none', expiresAt?: string };
   }
   ```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä: `npm run dev`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram Mini App
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å CORS, –¥–æ–±–∞–≤—å—Ç–µ –≤ –±—ç–∫–µ–Ω–¥ (`server.ts`):
```typescript
app.use(cors({
  origin: ['https://your-nextjs-domain.com', 'http://localhost:3000'],
  credentials: true
}));
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Next.js API —Ä–æ—É—Ç—ã, –∏–∑–º–µ–Ω–∏–≤ `config.api.baseUrl` –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å.

