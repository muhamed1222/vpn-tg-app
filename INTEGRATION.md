# Интеграция сайта с VPN ботом

## Обзор

Сайт интегрирован с API VPN бота для работы с реальными данными пользователей, подписками и оплатами.

## Что было сделано

### 1. API Сервис (`services/apiService.ts`)
- Создан сервис для работы с API бота
- Поддержка Telegram WebApp авторизации через `initData`
- Методы:
  - `getMe()` - получение данных пользователя
  - `getTariffs()` - получение списка тарифов
  - `createPayment()` - создание заказа на оплату
  - `checkPaymentStatus()` - проверка статуса оплаты

### 2. Telegram WebApp интеграция
- Добавлен скрипт Telegram WebApp SDK в `index.html`
- Автоматическая авторизация через Telegram WebApp
- Поддержка режима разработки (localStorage fallback)

### 3. Обновленные компоненты

#### `App.tsx`
- Интеграция с Telegram WebApp
- Загрузка данных пользователя из API
- Обновление подписки из API

#### `AccountGeneral.tsx`
- Получение реального VPN ключа из API
- Отображение статуса подписки

#### `Pay.tsx`
- Создание заказа через API бота
- Открытие инвойса Telegram для оплаты
- Обработка ошибок

#### `Result.tsx`
- Проверка статуса оплаты через API
- Автоматическое обновление подписки после оплаты

#### `constants.tsx`
- Планы синхронизированы с ботом:
  - `plan_7` - 7 дней (тест)
  - `plan_30` - 1 месяц
  - `plan_90` - 3 месяца
  - `plan_180` - 6 месяцев
  - `plan_365` - 12 месяцев

## Настройка

### 1. Переменные окружения

Создайте файл `.env` в корне проекта:

```env
# URL API бота
VITE_API_URL=https://vpn.outlivion.space
```

Для локальной разработки:
```env
VITE_API_URL=http://localhost:3000
```

### 2. Настройка бота

Убедитесь, что в боте настроены:
- CORS для домена сайта (в `server.ts`)
- `ALLOWED_ORIGINS` в переменных окружения бота

### 3. Telegram WebApp

Сайт должен быть доступен по HTTPS и добавлен как WebApp в настройках бота.

## API Endpoints

Сайт использует следующие endpoints бота:

- `GET /api/me` - данные пользователя
- `GET /api/tariffs` - список тарифов
- `POST /api/payment/create` - создание заказа
- `POST /api/payment/success` - проверка статуса оплаты

Все запросы требуют авторизации через Telegram `initData` в заголовке `Authorization`.

## Режим разработки

Если сайт запущен не в Telegram WebApp:
- Используется localStorage для хранения мокового пользователя
- Можно тестировать UI без реального API
- Для полной интеграции нужен Telegram WebApp

## Проверка работы

1. Откройте сайт через Telegram бота (как WebApp)
2. Авторизация должна произойти автоматически
3. В разделе "Аккаунт" должен отображаться реальный VPN ключ
4. При оплате должен открываться инвойс Telegram
5. После оплаты статус обновляется автоматически

## Troubleshooting

### Ошибка "Telegram WebApp не инициализирован"
- Убедитесь, что сайт открыт через Telegram
- Проверьте, что скрипт Telegram WebApp загружен

### Ошибка авторизации API
- Проверьте `VITE_API_URL` в `.env`
- Убедитесь, что бот запущен и доступен
- Проверьте CORS настройки в боте

### VPN ключ не загружается
- Проверьте, что у пользователя есть активная подписка
- Проверьте логи бота на наличие ошибок

